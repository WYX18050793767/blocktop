<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>头条新闻快讯</title>
    <meta name="baidu-site-verification" content="9h2o7ScMIE" />
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <link rel="stylesheet" href="css/NewsInformation.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/NewsFlash.css">
    <link rel="stylesheet" href="css/NewsDynamicContent.css">
</head>
<body>
<style>
    body{
        background: white!important;
    }
    #message_more{
        width: 100%;
        text-align: center;
        margin: 0 auto;
        color: #2e84fb;
        font-size: 20px;
        display: inline-block;
        position: relative;
        top: 60px;
        cursor: pointer;
    }
    .shareKx img{
        width: 2%;
        position: relative;
        top: 2px;

    }
    .Favorable-BadProfit{
        position: relative;
        width: 100%;
    }
    #GOUPID{
       margin-left: 480px;
    }
    .shareKx{
        margin-left: 20px;
        cursor: pointer;
    }
    .shareKx:hover .QRKX_Code{
      display: block;
    }
    .QRKX_Code{
        width: 150px;
        height: 180px;
        position: absolute;
        background: white;
        bottom: -190px;
        right: -35px;
        z-index: 99999999;
        display: none;
        border: 1px #eeeeee solid;
    }
    #CodeShare{
        width: 120px;
        height: 120px;
        margin-left: 10%;
        margin-top: 8px;
    }
    #WxTxH{
       width: 20%;
    }
    .WxSyX{
        width: 80%;
        margin: 10px auto;
        text-align: center;
    }
    .badDownGood{
        cursor: pointer;
    }
    .green{
        color: #00a911;
    }

</style>
<div class="box">
    <!--导航栏-->
    <!--#include file="header.html"-->

    <!--合作伙伴链接窗-->
    <div class="Partner-Links">
        <ul>
            <!--{foreach name='naviList' item='vo' }-->
            <li onclick='window.open("{$vo.target}")'>
                <div class="Partner-Links-WinD">
                    <div class="Partner-T">
                        <img src="{$vo.icon}" alt="" width="100%">
                    </div>
                    <div class="Partner-LinksText">
                        <p>{$vo.name}</p>
                        <p>{$vo.descrip}</p>
                    </div>
                </div>
            </li>
            <!--{/foreach}-->
        </ul>
    </div>
    <!--快讯-->
    <div class="Kx">
        <div class="NewsFlash">
            <div class="NewsFlash_box">
                <div class="NewsFlash_box_Content">
                    <!--标题-->
                    <div class="TItle_Flash">
                        <span>快讯</span>
                    </div>
                    <!--快讯内容-->
                    <div class="KxText">
                        <ul>
                            <!--{foreach name='messageList' item='vo' }-->
                            <li>
                                <div class="TuoY">
                                    <img src="images/TuoY.png" alt="" width="100%">
                                </div>
                                <div class="KxTime">
                                    <span>{$vo.time|format_time='H:i'}</span>
                                </div>
                                <!--内容-->
                                <div class="KxConttt">
                                    <div class="KxConttt_Title">{$vo.title}</div>
                                    <div class="KxConttt_Text">
                                        {$vo.content}
                                    </div>
                                    <div class="Favorable-BadProfit">
                                        <!--利好点前-->
                                        <span class="badDownGood greenUp" data-id='{$vo.id}' data-type='up' id="GOUPID">
                                            <img src="images/up.png" alt=""> 利好<span class="count-f">{$vo.up}</span>
                                        </span>

                                        <!--利好点后-->
                                        <!--<span class="badDownGood" data-id='{$vo.id}' data-type='up' id="GOUPID" style="color: #00a911">-->
                                            <!--<img src="images/up.png" alt=""> 利好<span class="count-f" style="color: #00a911">{$vo.up}</span>-->
                                        <!--</span>-->

                                        <!--利空点前-->
                                        <span class="badDownGood redDown" data-id='{$vo.id}' data-type='down'>
                                            <img src="images/down.png" alt=""> 利空<span class="count-f">{$vo.down}</span>
                                        </span>

                                        <!--利空点后-->
                                        <!--<span class="badDownGood" data-id='{$vo.id}' data-type='down' style="color:#A90000">-->
                                            <!--<img src="images/down.png" alt=""> 利空<span class="count-f" style="color:#A90000">{$vo.down}</span>-->
                                        <!--</span>-->
                                        <span class="shareKx">
                                            <img src="images/fenxiang.png" alt="">
                                            分享
                                            <span class="QRKX_Code">
                                                <img src="images/qrcode_message.png" alt="" id="CodeShare">
                                                <div class="WxSyX">
                                                    <img src="images/WxTxH.png" alt="" id="WxTxH">
                                                    <span>微信扫一扫</span>
                                                </div>


                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </li>
                            <!--{/foreach}-->
                        </ul>
                    </div>
                    <div>
                        <span id='message_more'>加载更多</span>
                    </div>

                </div>
            </div>

        </div>

        <div class="Hot-News Hot-v">
            <div class="Hot-News-content">
                <!--标题-->
                <div class="HotNewsTitle">
                    <span>热门新闻</span>
                    <span class="HotMore">
                        <a href='/news/all'>
                            更多>
                        </a>
                    </span>
                </div>
                <!--内容-->
                <div class="hot_New_Img">
                    <div class="hot_Img_TT">
                        <div onclick='window.location.href="/newsContent/1/{$newsFirst.content_id}"' class="hot_Img_TT_Im">
                            <img src="{$newsFirst['image']|default='images/news_default.png'}" alt="" width="100%">
                            <div class="hot_Hover_A">
                                {$newsFirst['title']}
                            </div>
                        </div>
                        <ul class="hot_NewContent_ul">
                            <!--{foreach name='newsList' item='vo' }-->
                            <li onclick='window.location.href="/newsContent/1/{$vo.content_id}"'>
                                <div class="hot_NewContentImg_Left">
                                    <img src="{$vo.image|default='images/news_default.png'}" alt="" width="100%">
                                </div>
                                <div class="hot_NewContent_Right">
                                    <div class="">
                                        {$vo.title}
                                    </div>
                                    <div>
                                        {$vo.time|format_time='Y-m-d'}
                                    </div>

                                </div>
                            </li>
                            <!--{/foreach}-->
                        </ul>

                    </div>


                </div>

            </div>
        </div>
    </div>

    <!--底部-->
    <!--#include file="footer.html"-->
</div>
</body>
</html>
<script src="js/jquery.js"></script>
<script src="js/commom.js"></script>
<script src="/themes/mobile/js/jquery.cookie.js"></script>
<script>

    function setCookie(c_name,value,expiredays)
    {
        var exdate=new Date();
        exdate.setDate(exdate.getDate()+expiredays);
        document.cookie=c_name+ "=" +escape(value)+ ((expiredays==null) ? "" : ";expires="+exdate.toGMTString());
        // $.cookie("cookieColor", "cookieValue", { expires: 365 });//第一种
    }
    //取回cookie
    function getCookie(c_name)
    {
        if (document.cookie.length>0)
        {
            c_start=document.cookie.indexOf(c_name + "=");
            if (c_start!=-1)
            {
                c_start=c_start + c_name.length+1;
                c_end=document.cookie.indexOf(";",c_start);
                if (c_end==-1) c_end=document.cookie.length;
                return unescape(document.cookie.substring(c_start,c_end))
            }
            // var cookieWord=$.cookie("cookieColor");
        }
        return "";
    }

    var cookie_value;

    var page_num = 2;
    $('#message_more').click(function(){
        
        $.ajax({
          type:"post",
          url:"/Home/Ajax/get_message",
          data:{page_num:page_num},
          dataType:'json',
          success:function(rdata){

            if(rdata.code==1){
                $('.KxText ul').append(rdata.data);
                page_num++;
                cookieReady()
            }else{
                $('#message_more').html(rdata.info);
            }
          }
        });
    });

    var id_arr = new Array();
    var arrcookieval = new Array();
    var id_cookieval;
    var data_id= new Array();
    var repeatId= new Array()

    $("body").on("click",".badDownGood",function () {
        var obj =$(this);
        var id = obj.attr('data-id');
        var type = obj.attr('data-type');
        id_arr.push(id+type);
        id_arr = id_arr.concat(id_cookieval);
        /*去重*/
        for(var i=0;i<id_arr.length;i++) {
            var items=id_arr[i];
            /**/
            if($.inArray(items,arrcookieval)==-1) {
                arrcookieval.push(items);
            }
        }
        console.log(arrcookieval);
        // /*取id相同值拿出来作比较*/
        // data_id.push(id);
        // var data_id_repeat=data_id.sort();
        // for(var i=0;i<data_id.length;i++){
        //     if (data_id_repeat[i]==data_id_repeat[i+1]){
        //         /*取出的相同id*/
        //         var id_repeat=data_id_repeat[i];
        //         repeatId.push(id_repeat);
        //     }
        // }
        // $.unique(repeatId.sort());
        // console.log(repeatId);
        // // var repeatIdval=repeatId.split(',');
        // /*看id值与数组内的id是否一致，一致的话做红绿颜色变换*/
        // $(".badDownGood").each(function () {
        //     var $this=$(this);
        //     var id = $this.attr('data-id');
        //     if(($.inArray(id,repeatId)) != -1){
        //         $this.css({
        //             "color":"silver"
        //         });
        //         $this.find("span").css({
        //             "color":"silver"
        //         });
        //
        //     }
        // });
        // data_id
        $.ajax({
          type:"post",
          url:"/Home/Ajax/opera_message",
          data:{id:id,type:type},
          dataType:'json',
          success:function(rdata){
            if(rdata.code==1){
                if(obj.hasClass("redDown")==true){
                    obj.css({
                        "color":"#A90000"
                    });
                    obj.find("span").css({
                        "color":"#A90000"
                    });
                    obj.find('.count-f').html(parseInt(obj.find('.count-f').html())+1);
                    // obj.prev().find('.count-f').html(parseInt(obj.find('.count-f').html())-1);
                }
                else {
                    obj.css({
                        "color":"#00a911"
                    });
                    obj.find("span").css({
                        "color":"#00a911"
                    });
                    obj.find('.count-f').html(parseInt(obj.find('.count-f').html())+1);
                    // obj.next().find('.count-f').html(parseInt(obj.find('.count-f').html())-1);
                }
                if(obj.css("color")=="rgb(0, 169, 17)"){
                    obj.css({"pointer-events":"none"});
                    // obj.next().css({"pointer-events":""});
                }
                if(obj.css("color")=="rgb(169, 0, 0)"){
                    obj.css({"pointer-events":"none"});
                    // obj.prev().css({"pointer-events":""});
                }
                // obj.find('.count-f').addClass("wyx");
                setCookie("arrcookieval",arrcookieval,365);
            }else{

            }
          }
        });
    });

    /*获取cookie操作*/
    function cookieReady(){
        var cookieval=$.cookie('arrcookieval');
        console.log($.cookie('arrcookieval'));
        id_cookieval=cookieval.split(',');
        /*遍历dataid*/
        $(".badDownGood").each(function () {
            var obj =$(this);
            var id = obj.attr('data-id');
            var type = obj.attr('data-type');
            if(($.inArray(id+type,id_cookieval)) != -1){
                // obj.find('.count-f').addClass("wyx");
                if(obj.hasClass("redDown")==true){
                    obj.find("span").css({
                        "color":"#A90000"
                    });
                    obj.css({
                        "color":"#A90000"
                    });
                    obj.css({"pointer-events":"none"});
                }else {
                    obj.find("span").css({
                        "color":"#00a911"
                    });
                    obj.css({
                        "color":"#00a911"
                    });
                    obj.css({"pointer-events":"none"});
                }
            }
        });
    }

    $(document).ready(function(){
        cookieReady()
    });


</script>
