

<!--用户注册-->
<div class="Headline-register">
    <!--注册账户-->
    <form action="" onsubmit="return false">
        <div class="reg-FraDiv-frame" id="reg-FraDiv-frame" type="1">
            <div class="reg-FraDiv" id="reg-FraDiv">

                <div class="registerTitle">
                    注册账户
                    <div class="guanbi" id="guanbi">
                        <img src="images/guanbi.png" alt="">
                    </div>

                </div>
                <!--输入手机号-->
                <div class="cell-phone-number">
                    <input type="text" placeholder="请输入手机号码" class="cell-phone-number-input">
                </div>

                <div class="Verification-Code" >
                    <input type="text" placeholder="验证码" class="Verification-Code-input">
                    <button class="Verification-Code-btn" id="Verification-Code-btn" onclick='send_yzm(this)' type="1">发送验证码</button>
                </div>
                <!--密码-->
                <div class="password">
                    <input type="password" placeholder="密码">
                </div>
                <div class="password">
                    <input type="password" placeholder="再次输入密码" class="againNewPassword">
                </div>
                <!--提交按钮-->
                <button class="submitBtn">
                    注册
                </button>
                <!--已有账户,直接登录>-->
                <div class="Sign-in-frame">
                    已有账户，直接登录>
                </div>
            </div>
        </div>
    </form>
    <!--&lt;!&ndash;登录&ndash;&gt;-->
    <form action="" onsubmit="return false">
        <div class="SignFrame" id="SignFrame" type="1">
            <div class="reg-FraDiv">
                <div class="registerTitle">
                    账号密码登录
                    <span class="reg-newAccount">注册新账号></span>
                    <div class="guanbi">
                        <img src="images/guanbi.png" alt="">
                    </div>
                </div>
                <!--输入手机号-->
                <div class="cell-phone-number">
                    <input type="text" placeholder="请输入手机号码" class="cell-phone-number-input">
                </div>
                <!--密码-->
                <div class="password">
                    <input type="password" placeholder="密码">
                </div>
                <!--忘记密码-->
                <div class="findPassword">
                    忘记密码
                </div>
                <!--提交按钮-->
                <button class="submitBtn">
                    确定
                </button>
                <!--短信登录-->
                <div class="SMS-login">
                    短信登录
                </div>
            </div>
        </div>
    </form>
    <!--找回密码-->
    <form action="" onsubmit="return false">
        <div class="retrieve-password-frame" id="retrieve-password-frame">
            <div class="reg-FraDiv">
                <div class="registerTitle">
                    找回密码
                    <div class="guanbi">
                        <img src="images/guanbi.png" alt="">
                    </div>
                </div>
                <!--输入手机号-->
                <div class="cell-phone-number">
                    <input type="text" placeholder="请输入手机号码" class="cell-phone-number-input">
                </div>

                <!--验证码-->
                <div class="Verification-Code">
                    <input type="text" placeholder="验证码" class="Verification-Code-input">
                    <button class="VerificationFindpassword" id="VerificationFindpassword" onclick='send_yzm(this)' type="3">发送验证码</button>
                </div>
                <!--密码-->
                <div class="password">
                    <input type="password" placeholder="输入新密码" class="newPassword">
                </div>
                <div class="password">
                    <input type="password" placeholder="再次输入密码" class="againNewPassword">
                </div>
                <!--提交按钮-->
                <button class="submitBtn">
                    确定
                </button>
                <!--已有账户,直接登录>-->
                <div class="Sign-in-frame">
                    已有账户,直接登录>
                </div>
            </div>
        </div>
    </form>

    <!--短信登录-->
    <form action="" onsubmit="return false">
        <div class="SMSLogin-frame" id="SMSLogin-frame" type="2">
            <div class="reg-FraDiv">
                <div class="registerTitle">
                    短信登录
                    <div class="guanbi">
                        <img src="images/guanbi.png" alt="">
                    </div>
                </div>
                <!--输入手机号-->
                <div class="cell-phone-number">
                    <input type="text" placeholder="请输入手机号码" class="cell-phone-number-input">
                </div>
                <!--验证码-->
                <div class="Verification-Code">
                    <input type="text" placeholder="验证码" class="Verification-Code-input">
                    <button class="VerificationCodeLogin" onclick='send_yzm(this)' type="2">发送验证码</button>
                </div>
                <!--提交按钮-->
                <button class="submitBtn">
                    确定
                </button>
                <!--账号登录-->
                <div class="account-login">
                    账号登录
                </div>
            </div>
        </div>
    </form>

</div>

<!--最顶部logo与注册登录-->
<div style="position: fixed;top:0;z-index:1000;background: white;width: 100%;max-width: 640px;min-width: 320px;margin: 0 auto">
    <div class="topMost">
        <!--logo-->
        <div class="topLogo">
            <img src="images/topLogo.png" alt="">
        </div>
        <!--注册登录-->
        <div class="signInTop">
            <!--{if condition="$loginInfo"}-->
            <!--登录成功-->
            <div id="Loginsuccess">
                <img src="images/TxImg.png" alt="" class="TxImg">
                <span class="TxName">{$loginInfo['nickname']}<img src="images/TxMore.png" alt=""></span>
            </div>
            <div class="Login-successful">
                <ul>
                    <li onclick='window.location.href="/Home/User/myPage"'>个人主页</li>
                    <li id="Log-out">退出登陆</li>
                </ul>
            </div>
            <!--{else /}-->
            <!--未登录-->
            <div>
                <div class="registerbtn">注册</div>
                <div class="signInbtn">登陆</div>
            </div>
            <!--{/if}-->

        </div>

    </div>
    <!--导航栏-->
    <div class="boxNav">
        <!--boxNav ul-->
        <div class="boxNav-ul">
            <ul>
                <li onclick='window.location.href="/home_m/all"'>首页</li>
                <li onclick='window.location.href="/message_m"'>7*24快讯</li>
                <li onclick='window.location.href="/columns_list_m"'>专栏</li>
                <li onclick='window.location.href="/topmap_m/recom"'>导航</li>
            </ul>
        </div>
        <!--导航按钮-->
        <div class="navigationBtn">
            <img src="images/navber.png" alt="">
            <!--下拉菜单-->
        </div>
        <ul id="Dhl">
            <li class="header_list"><a href="/home_m/all">首页</a></li>
            <li class="header_list"><a href="/topmap_m/recom">头条导航</a></li>
            <li class="header_list"><a href="/message_m">7*24快讯</a></li>
            <li class="header_list"><a href="/columns_list_m">专栏</a></li>
            <li class="header_list"><a href="/aboutus_m">关于我们</a></li>
        </ul>
    </div>
</div>
<div style="margin-top: 1.8rem">

</div>

<script src="js/jquery.js"></script>
<script src="/themes/default/js/layui/layui.all.js"></script>
<script>
    layui.use('layer', function(){  //layer弹框
        var layer = layui.layer;
    });
  /*退出登陆*/
    $("#Log-out").click(function () {
        $.ajax({
            type:"post",
            url:"/Home/User/logout",
            data:{},
            dataType:'json',
            success:function(data){
                console.log(data);
                if(data.code==1){
                    layer.msg(data.info);
                    setTimeout(function () {
                        location.reload();
                    },1000)
                }else{
                    layer.msg(data.info);
                }
            }
        });
    });


    var countdown =60;
    var Timeid;
    //倒计时
    function send_yzm(val){
        var valClass=val.className;
        var yzm=$('.'+valClass+'').parent().siblings(".VerificationImgBtn")
        // var valClass=val.className;
        var phone = $('.'+valClass+'').parent().siblings(".cell-phone-number").find("input").val();
        var type=$('.'+valClass+'').attr("type");
        $.ajax({
            type:"post",
            url:"/Home/User/send_code",
            data:{phone:phone,type:type},
            dataType:'json',
            success:function(data){
                console.log(data);
                if(data.code==1){
                    settime(val)
                }
                if(data.code==3){
                    layer.msg(data.info+"，距离下次发送还有"+(60-(data.data))+"秒");
                }
                else{
                    layer.msg(data.info);
                }
            }
        });
    }
    /*倒计时*/
    function settime(val){
        var valClass=val.className;
        if (countdown == 0){
            $('.'+valClass+'').css({
                "pointer-events":"",
                "background":"#0c7ff2"
            });
            val.innerHTML = "发送验证码";
            countdown = 60;
            return false
        }
        else {
            $('.'+valClass+'').css({
                "pointer-events":"none",
                "background":"#aaaaaa"
            });
            val.innerHTML = "重新发送(" + countdown + ")";
            countdown--;
            // console.log(countdown)
        }
        Timeid=setTimeout(function() {
            settime(val);
        }, 1000);
    }

    $(document).ready(function() {
        if($(".when-landing").hasClass("when-landing-Ac")){
            $(".activitsPopupbtn").hide()
        }
    });



    /*四个表单提交*/
    /*注册登录*/
    $(document).on('click','#reg-FraDiv-frame .submitBtn',function() {
        var number = /^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/;
        var phone_number=$("#reg-FraDiv-frame .cell-phone-number-input").val();
        var password=$("#reg-FraDiv-frame .password input").val();
        var Verification_Code=$("#reg-FraDiv-frame .Verification-Code-input").val();
        var repassword=$("#reg-FraDiv-frame .againNewPassword").val();
        if(phone_number==''||phone_number=='null'){
            layer.msg('您的电话不能为空');
            return false
        }
        if(!number.test(phone_number)){
            layer.msg('手机号码不正确，请重新输入');
            return false
        }
        if(Verification_Code==''||Verification_Code=='null'){
            layer.msg('您的验证码不能为空');
            return false
        }
        if(password==''||password=='null'){
            layer.msg('您的密码不能为空');
            return false
        }
        if(password!=repassword){
            layer.msg('两次输入的密码不一致');
            return false
        }
        else {
            $.ajax({
                type:"post",
                url:"/Home/User/register",
                data:{phone:phone_number,code:Verification_Code,repassword:repassword,password:password},
                dataType:'json',
                success:function(data){
                    // console.log(data);
                    if(data.code==1){
                        layer.msg('注册成功');
                        $(".ActivitPopupCode").show();
                        $(".Headline-register").hide()
                        $("#closePopupCode").click(function () {
                            $(".ActivitPopupCode").hide();
                            location.reload()
                        })

                    }else{
                        // console.log(data.info);
                        layer.msg(data.info);
                    }
                }
            });
        }
    });
    /*账号密码登录*/
    $(document).on('click','#SignFrame .submitBtn',function() {
        var number = /^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/;
        var phone_number=$("#SignFrame .cell-phone-number-input").val();
        var password=$("#SignFrame .password input").val();
        var type=$("#SignFrame").attr("type");
        console.log(type);
        if(phone_number==''||phone_number=='null'){
            layer.msg('您的电话不能为空');
            return false
        }
        if(!number.test(phone_number)){
            layer.msg('手机号码不正确，请重新输入');
            return false
        }
        if(password==''||password=='null'){
            layer.msg('您的密码不能为空');
            return false
        }
        else {
            $.ajax({
                type:"post",
                url:"/Home/User/accountLogin",
                data:{phone:phone_number,password:password,type:type},
                dataType:'json',
                success:function(data){
                    console.log(data);
                    if(data.code==1){
                        // console.log(data.data.nickname)
                        layer.msg('登录成功');
                        location.reload();
                        $(".userbtn").hide();
                        $(".when-landing").show();
                        $(".usernamenumber").html(data.data.nickname);
                    }else{
                        // console.log(data.info);
                        layer.msg(data.info);
                    }
                }
            });
        }
    });
    /*找回密码*/
    $(document).on('click','#retrieve-password-frame .submitBtn',function() {
        var number = /^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/;
        var phone_number=$("#retrieve-password-frame .cell-phone-number-input").val();
        var againNewPassword=$("#retrieve-password-frame .againNewPassword").val();
        var newPassword=$("#retrieve-password-frame .newPassword").val();
        var Verification_Code=$("#retrieve-password-frame .Verification-Code-input").val();

        if(phone_number==''||phone_number=='null'){
            layer.msg('您的电话不能为空');
            return false
        }
        if(!number.test(phone_number)){
            layer.msg('手机号码不正确，请重新输入');
            return false
        }
        if(Verification_Code==''||Verification_Code=='null'){
            layer.msg('您的验证码不能为空');
            return false
        }
        if(newPassword==''||newPassword=='null'){
            layer.msg('新密码不能为空');
            return false
        }
        if(againNewPassword==''||againNewPassword=='null'){
            layer.msg('请核对新密码');
            return false
        }
        if(newPassword!=againNewPassword){
            layer.msg('输入的两次密码不吻合');
            return false
        }

        else {
            $.ajax({
                type:"post",
                url:"/Home/User/getPassword",
                data:{phone:phone_number,password:newPassword,repassword:againNewPassword,code:Verification_Code},
                dataType:'json',
                success:function(data){
                    console.log(data);
                    if(data.code==1){ // 显示用户数据 隐藏输入框
                        layer.msg('修改成功');
                        location.reload()
                    }else{
                        layer.msg(data.info);
                        // console.log(data.info);
                    }
                }
            });
        }
    });
    /*短信登录*/
    $(document).on('click','#SMSLogin-frame .submitBtn',function() {
        var number = /^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/;
        var phone_number=$("#SMSLogin-frame .cell-phone-number-input").val();
        var Verification_Code=$("#SMSLogin-frame .Verification-Code-input").val();
        var type=$("#SMSLogin-frame").attr("type");
        if(phone_number==''||phone_number=='null'){
            layer.msg('您的电话不能为空');
            return false
        }
        if(!number.test(phone_number)){
            layer.msg('手机号码不正确，请重新输入');
            return false
        }
        if(Verification_Code==''||Verification_Code=='null'){
            layer.msg('您的验证码不能为空');
            return false
        }
        else {
            $.ajax({
                type:"post",
                url:"/Home/User/accountLogin",
                data:{phone:phone_number,code:Verification_Code,type:type},
                dataType:'json',
                success:function(data){
                    console.log(data);
                    if(data.code==1){
                        layer.msg('登录成功');
                        location.reload()
                    }else{
                        // console.log(data.info);
                        layer.msg(data.info);
                    }
                }
            });
        }
    });

    /*关闭弹窗*/
    $(document).on('click','.guanbi',function() {
        $(".Headline-register").hide()
    });
    /*注册*/
    $(document).on('click','.registerbtn',function() {
        $("#reg-FraDiv-frame").show();
        $(".Headline-register").show()
        $("#retrieve-password-frame").hide();
        $("#SignFrame").hide();
        $("#SMSLogin-frame").hide()
    });
    /*登录*/
    $(document).on('click','.signInbtn',function() {
        $("#SignFrame").show();
        $("#reg-FraDiv-frame").hide();
        $(".Headline-register").show();
        $("#retrieve-password-frame").hide();
        $("#SMSLogin-frame").hide()
    });
    /*注册新账号*/
    $(document).on('click','.reg-newAccount',function() {
        $("#reg-FraDiv-frame").show();
        $("#SignFrame").hide();
        $("#retrieve-password-frame").hide();
        clearTimeout(Timeid);
        countdown =60;
        $("#reg-FraDiv-frame").load(location.href + " #reg-FraDiv-frame")
    })
    /*找回密码*/
    $(document).on('click','.findPassword',function() {
        $("#reg-FraDiv-frame").hide();
        $("#SignFrame").hide();
        $("#retrieve-password-frame").show();
        clearTimeout(Timeid);
        countdown =60;
        $("#retrieve-password-frame").load(location.href + " #retrieve-password-frame")
    });
    /*直接登录*/
    $(document).on('click','.Sign-in-frame',function() {
        $("#reg-FraDiv-frame").hide();
        $("#SignFrame").show();
        $("#retrieve-password-frame").hide();
        clearTimeout(Timeid);
        countdown =60;
    });
    /*账号登录*/
    $(document).on('click','.account-login',function() {
        $("#SignFrame").show();
        $(".SMSLogin-frame").hide()
    });
    /*短信登录*/
    $(document).on('click','.SMS-login',function() {
        $("#SignFrame").hide();
        $(".SMSLogin-frame").show();
        clearTimeout(Timeid);
        countdown =60;
        $("#SMSLogin-frame").load(location.href + " #SMSLogin-frame")
    });
</script>